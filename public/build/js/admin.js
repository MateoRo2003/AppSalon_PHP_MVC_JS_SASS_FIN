function iniciarApp(){consultarTotales(),obtenerTotalGanado()}function updateDuracionTotal(){const t=document.querySelectorAll('input[name="servicios[]"]:checked');let e=0;t.forEach((t=>{const a=parseInt(t.getAttribute("data-duration"));e+=a})),citaAdmin.duracionTotal=e,document.getElementById("duracionTotal").value=citaAdmin.duracionTotal}async function CerrarCaja(){const t=document.getElementById("totalGanadoTexto").innerText.replace("$","").replace(",","").trim();console.log(t,"total ganado");const e=(new Date).toISOString().split("T")[0],a=[];if(document.querySelectorAll("#citasRealizadasData span").forEach((t=>{const e=parseFloat(t.dataset.precio);console.log(e,"precio de la cita"),a.push({id:t.dataset.id,precio:e.toFixed(2),fecha:t.dataset.fecha})})),0!==a.length){Swal.fire({title:"Cerrando caja...",text:"Por favor espera mientras se procesa la caja.",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}});try{const o=await fetch("/api/cierreCaja",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({total:parseInt(t),fecha:e,citas:a})}),r=await o.json();if(!o.ok)throw new Error(r.message||"Error al cerrar caja");Swal.fire({icon:"success",title:"Caja cerrada",text:"La caja se ha cerrado correctamente.",timer:2e3,showConfirmButton:!1}),document.getElementById("totalGanadoTexto").innerText="$0",setTimeout((()=>{location.reload()}),2e3)}catch(t){Swal.fire({icon:"error",title:"Error",text:t.message||"Hubo un problema al cerrar la caja."})}}else Swal.fire({icon:"warning",title:"No hay citas realizadas",text:"Debes estar en la categoria de Citas Realizadas para cerrar la caja."})}function obtenerTotalGanado(){fetch("/api/TotalGanado").then((t=>t.json())).then((t=>{console.log(t),Array.isArray(t)&&t.length>0?actualizarTotalGanado(t):console.warn("No se encontraron registros de total ganado.")})).catch((t=>console.error("Error al obtener los totales:",t)))}function actualizarTotalGanado(t){const e=document.getElementById("totalGanadoTexto"),a=t.reduce(((t,e)=>t+parseFloat(e.total_ganado)),0);e.textContent=`$${a.toLocaleString()}`}async function consultarTotales(){try{const t="/api/totales",e=await fetch(t);if(!e.ok)throw new Error("Error al obtener los datos");const a=await e.json();console.log(a),actualizarTarjetas(a)}catch(t){console.error("Error al consultar la API:",t)}}function actualizarTarjetas(t){document.querySelector(".tarjeta .numero").textContent=t.totalClientes,document.querySelectorAll(".tarjeta")[1].querySelector(".numero").textContent=t.totalServicios,document.querySelectorAll(".tarjeta")[2].querySelector(".numero").textContent=t.totalSuscripciones,document.querySelectorAll(".tarjeta")[3].querySelector(".numero").textContent=t.totalCitas}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()})),document.querySelectorAll('input[name="servicios[]"]').forEach((t=>{t.addEventListener("change",updateDuracionTotal)}));